<!DOCTYPE html>
<html dir="rtl" direction="rtl" layout:decorate="_layout" style="direction: rtl"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<body>
<!--begin::Toolbar-->
<div layout:fragment="toolbar">
    <!--begin::Toolbar-->
    <div class="app-toolbar py-6" id="kt_app_toolbar">
        <!--begin::Toolbar container-->
        <div class="app-container container-xxl d-flex align-items-start" id="kt_app_toolbar_container">
            <!--begin::Toolbar container-->
            <div class="d-flex flex-column flex-row-fluid">
                <!--begin::Toolbar wrapper-->
                <div class="d-flex align-items-center pt-1">
                    <!--begin::Breadcrumb-->
                    <ul class="breadcrumb breadcrumb-separatorless fw-semibold">
                        <!--begin::Item-->
                        <li class="breadcrumb-item text-white fw-bold lh-1">
                            <a class="text-white" href="/boodge/showalledarekol">
                                <i class="fonticon-home text-white fs-3"></i>
                            </a>
                        </li>
                        <!--end::Item-->
                        <!--begin::Item-->
                        <li class="breadcrumb-item">
                            <!--begin::Svg Icon | path: icons/duotune/arrows/arr071.svg-->
                            <span class="svg-icon svg-icon-4 svg-icon-white mx-n1">
												<svg fill="none" height="24" viewBox="0 0 24 24" width="24"
                                                     xmlns="http://www.w3.org/2000/svg">
													<path d="M12.6343 12.5657L8.45001 16.75C8.0358 17.1642 8.0358 17.8358 8.45001 18.25C8.86423 18.6642 9.5358 18.6642 9.95001 18.25L15.4929 12.7071C15.8834 12.3166 15.8834 11.6834 15.4929 11.2929L9.95001 5.75C9.5358 5.33579 8.86423 5.33579 8.45001 5.75C8.0358 6.16421 8.0358 6.83579 8.45001 7.25L12.6343 11.4343C12.9467 11.7467 12.9467 12.2533 12.6343 12.5657Z"
                                                          fill="currentColor"/>
												</svg>
											</span>
                            <!--end::Svg Icon-->
                        </li>
                        <!--end::Item-->
                        <!--begin::Item-->
                        <li class="breadcrumb-item text-white fw-bold lh-1">ادارات</li>
                        <!--end::Item-->
                    </ul>
                    <!--end::Breadcrumb-->
                </div>
                <!--end::Toolbar wrapper=-->
                <!--begin::Toolbar wrapper=-->
                <div class="d-flex flex-stack flex-wrap flex-lg-nowrap gap-4 gap-lg-10 pt-6 pb-18 py-lg-13">
                    <!--begin::Page title-->
                    <div class="page-title d-flex align-items-center me-3">
                        <img alt="Logo" class="h-60px me-5" th:src="@{/assets/media/svg/misc/layer.svg}"/>
                        <!--begin::Title-->
                        <h1 class="page-heading d-flex text-white fw-bolder fs-2 flex-column justify-content-center my-0">
                            جزئیات بودجه ادارات کل معاونت فضای مجازی، هنر و رسانه
                        </h1>
                        <!--end::Title-->
                    </div>
                    <!--end::Page title-->
                    <!--begin::Items-->
                    <div class="d-flex gap-6">
                        <!--begin::Item-->
                        <div class="d-flex flex-column" id="mosavaMoavenat">
                        </div>
                        <!--end::Item-->
                        <!--begin::Item-->
                        <div class="d-flex flex-column" id="takhsisMoavenat">
                        </div>
                        <!--end::Item-->
                        <!--begin::Item-->
                        <div class="d-flex flex-column" id="amalkardMoavenat">
                        </div>
                        <!--end::Item--><!--begin::Item-->
                        <div class="d-flex flex-column" id="amalkardNamehMoavenat">
                        </div>
                        <!--end::Item-->
                    </div>
                    <!--end::Items-->
                </div>
                <!--end::Toolbar wrapper=-->
            </div>
            <!--end::Toolbar container=-->
        </div>
        <!--end::Toolbar container-->
    </div>
    <!--end::Toolbar-->

</div>
<!--end::Toolbar-->
<div layout:fragment="content">

    <div class="container">
        <div class="row">
            <div class="col">
            <div class="card">
                <div class="card-body">
                    <div id="chart"></div>
                </div>
            </div>
            </div>
        </div>
    </div>

    <hr/>

    <div class="container" id="showBoodgeDetails">
    </div>

</div>


<div layout:fragment="extrajs">
    <script th:src="@{/assets/js/utils/chartjs.min.js}" type="text/javascript"></script>
    <script th:src="@{/assets/js/utils/apexcharts.min.js}"></script>
    <link th:href="@{/assets/css/utils/apexcharts.css}" rel="stylesheet" type="text/css"/>

    <script th:inline="javascript">
        /*<![CDATA[*/
        var message = /*[[${edarekol}]]*/ null;
        /*]]>*/
        console.log(message);

        $('#mosavaMoavenat').append("<!--begin::Section-->\n" +
            "                        <div class=\"text-white fw-bold fs-3 mb-1\">" + (message.mosavabSum).toLocaleString("en-US") + ' ریال' + "</div>\n" +
            "                        <!--end::Section-->" +
            "<!--begin::Section-->" +
            "<div class=\"text-white opacity-50 fw-bold\">کل مصوب معاونت</div>" +
            "<!--end::Section-->");

        $('#takhsisMoavenat').append("<!--begin::Section-->\n" +
            "                        <div class=\"text-white fw-bold fs-3 mb-1\">" + (message.takhsisSum).toLocaleString("en-US") + ' ریال' + "</div>\n" +
            "                        <!--end::Section-->"
            + "<!--begin::Section-->\n" +
            "                            <div class=\"text-white opacity-50 fw-bold\">کل تخصیص معاونت</div>\n" +
            "                            <!--end::Section-->"
        );
        $('#amalkardMoavenat').append("<!--begin::Section-->\n" +
            "                        <div class=\"text-white fw-bold fs-3 mb-1\">" + (message.amalkardSum).toLocaleString("en-US") + ' ریال' + "</div>\n" +
            "                        <!--end::Section-->"
            + "<!--begin::Section-->\n" +
            "                            <div class=\"text-white opacity-50 fw-bold\">عملکرد ساتع معاونت</div>\n" +
            "                            <!--end::Section-->"
        );
        $('#amalkardNamehMoavenat').append("<!--begin::Section-->\n" +
            "                        <div class=\"text-white fw-bold fs-3 mb-1\">" + (message.amalkardNameDaryaftySum).toLocaleString("en-US") + ' ریال' + "</div>\n" +
            "                        <!--end::Section-->"
            + "<!--begin::Section-->\n" +
            "                            <div class=\"text-white opacity-50 fw-bold\">عمکرد نامه ای معاونت</div>\n" +
            "                            <!--end::Section-->"
        );


        var mosavab;
        var takhsis;
        var amalkard;
        var htmlBuilder = '<div class="row">'
        var button;
        for (i = 0; i < message.edareKolViewModelList.length; i++) {
            mosavab = (message.edareKolViewModelList[i].mosavab).toLocaleString("en-US");
            takhsis = (message.edareKolViewModelList[i].takhsis).toLocaleString("en-US");
            amalkard = (message.edareKolViewModelList[i].amalkard).toLocaleString("en-US");


            if ((i % 3) == 0 && i != 0) {
                htmlBuilder += "</div><div class='row'>";
            }

            htmlBuilder += "<div class=\"col-xl-4\">\n" +
                "        <!--begin::Mixed Widget 4-->\n" +
                "        <div class=\"card card-xl-stretch mb-xl-8\">\n" +
                "<!--begin::Beader-->\n" +
                "<div class=\"card-header border-0 py-5\">\n" +
                "    <h3 class=\"card-title align-items-start flex-column\">\n" +
                "        <span class=\"card-label fw-bold mb-1\">"+message.edareKolViewModelList[i].edareKolName+"</span>\n" +
                "    </h3>\n" +
                "    <div class=\"card-toolbar\">\n" +
                "    </div>\n" +
                "</div>\n" +
                "<!--end::Header-->"+
                "            <!--begin::Body-->\n" +
                "            <div class=\"card-body d-flex flex-column\">\n" +
                "                <div class=\"flex-grow-1\">\n" +
                "                    <div class=\"mixed-widget-4-chart\" data-kt-chart-color=\"primary\" style=\"height: 200px\" id=\"edareKol" + (i + 1) + "\"></div>\n" +
                "                </div>\n" +
                "                <div class=\"pt-5\">\n" +
                "                    <p class=\"text-center fs-6 pb-5\">\n" +
                "<span class='fs-4 fw-semibold text-warning pb-1 px-2'>مصوب</span>" +
                "                        <span class=\"fw-bold d-flex justify-content-center\"><span data-kt-countup=\"true\" data-kt-countup-value=" + mosavab + ">0</span> ریال </span>" +
                "\n" +
                "                    </p>\n" +
                "<div class='d-flex gap-4 justify-content-center'> " +
                "                    <p class=\"text-center fs-6 pb-5\">\n" +
                "<span class='fs-4 fw-semibold text-primary pb-1 px-2'>تخصیص</span>" +
                "                        <span class=\"fw-bold d-flex justify-content-center\"><span data-kt-countup=\"true\" data-kt-countup-value=" + takhsis + ">0</span>  ریال </span>" +
                "\n" +
                "                    </p>\n" +
                "                    <p class=\"text-center fs-6 pb-5\">\n" +
                "<span class='fs-4 fw-semibold text-danger pb-1 px-2'>عملکرد</span>" +
                "<span class=\"fw-bold d-flex justify-content-center\"><span data-kt-countup=\"true\" data-kt-countup-value=" + amalkard + ">0</span> ریال </span>" +
                "\n" +
                "                    </p></div>\n"
                +"                    <a href='boodge/edarekoldetails/"+message.edareKolViewModelList[i].edareKolName+"' class=\"btn btn-light-danger w-100 py-3\">نمایش جزئیات</a>\n"+
                "                </div>\n" +
                "            </div>\n" +
                "            <!--end::Body-->\n" +
                "        </div>\n" +
                "        <!--end::Mixed Widget 4-->\n" +
                "    </div>\n" +
                "    <!--end::Col-->\n"


        }

        $('#showBoodgeDetails').append(htmlBuilder);

        var darsadTakhsis;
        var darsadAmalkard;
        for (i = 0; i < message.edareKolViewModelList.length; i++) {
            if (message.edareKolViewModelList[i].mosavab == 0)
                message.edareKolViewModelList[i].mosavab = 1;
            darsadTakhsis = message.edareKolViewModelList[i].takhsis / message.edareKolViewModelList[i].mosavab * 100;
            darsadAmalkard = message.edareKolViewModelList[i].amalkard / message.edareKolViewModelList[i].mosavab * 100;
            createChart(Math.floor(darsadTakhsis), Math.floor(darsadAmalkard), (i + 1), message.edareKolViewModelList[i].edareKolName)
        }

        function createChart(darsadTakhsis, darsatAmalkard, number, edareTitle) {
            var chart = new ApexCharts(document.querySelector("#edareKol" + number),
                createChartConfig(darsadTakhsis, darsatAmalkard, edareTitle)
            );
            chart.render();

        }

        createCompoundChart(message);

        function createCompoundChart(options) {
            console.log(options.edareKolViewModelList);
            options.edareKolViewModelList.sort((a,b) => (a.edareKolName < b.edareKolName) ? 1 : (b.edareKoleName < a.edareKolName) ? -1 : 0);
            console.log(options.edareKolViewModelList);
            var chartSeries = [];
            var chartLabels = [];
            var adad;
            for (i = 0; i < options.edareKolViewModelList.length; i++) {
                adad = options.edareKolViewModelList[i].mosavab == 0 ? 1 : (Math.floor(options.edareKolViewModelList[i].takhsis / options.edareKolViewModelList[i].mosavab * 100));
                console.log("mosavab:   " + adad);
                chartLabels.push(options.edareKolViewModelList[i].edareKolName)
                chartSeries.push(adad);
            }

            var options = {

                series: chartSeries,
                chart: {
                    height: 390,
                    type: 'radialBar',
                },
                plotOptions: {
                    radialBar: {
                        offsetY: 0,
                        startAngle: 0,
                        endAngle: 270,
                        hollow: {
                            margin: 5,
                            size: '30%',
                            background: 'transparent',
                            image: undefined,
                        },
                        dataLabels: {
                            name: {
                                show: false,
                            },
                            value: {
                                show: false,
                            }
                        }
                    }
                },
                colors: ['#0292f8', '#0266fc', '#0738d5', '#0223fc'],
                labels: chartLabels,
                legend: {
                    show: true,
                    floating: true,
                    fontSize: '16px',
                    position: 'left',
                    offsetX: 280,
                    offsetY: 15,
                    labels: {
                        useSeriesColors: true,
                    },
                    markers: {
                        size: 0
                    },
                    formatter: function (seriesName, opts) {
                        return seriesName + ":  " + opts.w.globals.series[opts.seriesIndex] +"%"
                    },
                    itemMargin: {
                        vertical: 3
                    }
                },
                responsive: [{
                    breakpoint: 480,
                    options: {
                        legend: {
                            show: false
                        }
                    }
                }]
            };

            var chart = new ApexCharts(document.querySelector("#chart"), options);
            chart.render();
        }

        function createChartConfig(darsadTakhsis, darsadAmalkard, edareTitle) {
            var options = {
                chart: {
                    type: "radialBar",
                    height: 250,
                    offsetX: 0
                },
                dataLabels: {
                    enable: true,
                    style: {
                        fontSize: '4px'
                    }
                }
                ,
                plotOptions: {
                    radialBar: {
                        inverseOrder: false,
                        hollow: {
                            margin: 5,
                            size: "60%",
                            background: "transparent"
                        },
                        track: {
                            show: true,
                            background: "#40475D",
                            strokeWidth: "30%",
                            opacity: 1,
                            margin: 3 // margin is in pixels
                        }
                    }
                },
                colors: ['#2c9aff', '#f1416c'],
                series: [darsadTakhsis, darsadAmalkard],
                labels: ["تخصیص از مصوب", "عملکرد از مصوب"],
                legend: {
                    show: true,
                    position: "bottom",
                    offsetX: -30,
                    offsetY: -10,
                    formatter: function (val, opts) {
                        return val + " - " + opts.w.globals.series[opts.seriesIndex] + "%";
                    }
                },
                fill: {
                    type: "gradient",
                    gradient: {
                        shade: "dark",
                        type: "horizontal",
                        shadeIntensity: 0.5,
                        inverseColors: true,
                        opacityFrom: 1,
                        opacityTo: 1,
                        stops: [0, 100]
                    }
                }
            };
            return options;
        }

    </script>
</div>


</body>
</html>